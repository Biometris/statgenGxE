<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>AMMI analysis — gxeAmmi • statgenGxE</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="AMMI analysis — gxeAmmi"><meta name="description" content="The Additive Main Effects and Multiplicative Interaction (AMMI) model fits
a model which involves the Additive Main effects (i.e. genotype and trial)
along with Multiplicative Interaction effects. The additive effects are the
classical ANOVA main effects for genotype and environment, the
multiplicative effects follow from a principal component analysis on the
interaction residuals (= genotype by environment means after adjustment for
additive genotype and environment effects). This results in an interaction
characterized by Interaction Principal Components (IPCA) enabling
simultaneous plotting of genotypes and trials.
The parameter nPC is used to indicate the number of principal
components that is used in the principal component analysis (PCA). By setting
this parameter to NULL the algorithm determines the best number of
principal components (see Details).
By specifying the parameter byYear = TRUE, a separate analysis will be
done for every year in the data. Combining the option with nPC = NULL
may result in different numbers of principal components per year. The AMMI
estimates will still be returned as a single data.frame, but the other
results will be either lists or arrays."><meta property="og:description" content="The Additive Main Effects and Multiplicative Interaction (AMMI) model fits
a model which involves the Additive Main effects (i.e. genotype and trial)
along with Multiplicative Interaction effects. The additive effects are the
classical ANOVA main effects for genotype and environment, the
multiplicative effects follow from a principal component analysis on the
interaction residuals (= genotype by environment means after adjustment for
additive genotype and environment effects). This results in an interaction
characterized by Interaction Principal Components (IPCA) enabling
simultaneous plotting of genotypes and trials.
The parameter nPC is used to indicate the number of principal
components that is used in the principal component analysis (PCA). By setting
this parameter to NULL the algorithm determines the best number of
principal components (see Details).
By specifying the parameter byYear = TRUE, a separate analysis will be
done for every year in the data. Combining the option with nPC = NULL
may result in different numbers of principal components per year. The AMMI
estimates will still be returned as a single data.frame, but the other
results will be either lists or arrays."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">statgenGxE</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.9</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../articles/index.html">Vignettes</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="nav-link" href="../news/index.html"><span class="fa fa-newspaper-o"></span> news</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html"><span class="fa fa-file-code-o"></span> functions</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-other-packages" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fa-seedling"></span> other packages</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-other-packages"><li><a class="external-link dropdown-item" href="https://biometris.github.io/statgenSTA">statgenSTA</a></li>
    <li><a class="external-link dropdown-item" href="https://biometris.github.io/statgenGWAS">statgenGWAS</a></li>
    <li><a class="external-link dropdown-item" href="https://biometris.github.io/statgenHTP">statgenHTP</a></li>
    <li><a class="external-link dropdown-item" href="https://biometris.github.io/statgenIBD">statgenIBD</a></li>
    <li><a class="external-link dropdown-item" href="https://biometris.github.io/statgenMPP">statgenMPP</a></li>
    <li><a class="external-link dropdown-item" href="https://biometris.github.io/statgenQTLxT">statgenQTLxT</a></li>
    <li><a class="external-link dropdown-item" href="https://biometris.github.io/LMMsolver">LMMsolver</a></li>
  </ul></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Biometris/statgenGxE"><span class="fa fa-github fa-lg"></span> github</a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>AMMI analysis</h1>
      <small class="dont-index">Source: <a href="https://github.com/Biometris/statgenGxE/blob/main/R/gxeAmmi.R" class="external-link"><code>R/gxeAmmi.R</code></a></small>
      <div class="d-none name"><code>gxeAmmi.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The Additive Main Effects and Multiplicative Interaction (AMMI) model fits
a model which involves the Additive Main effects (i.e. genotype and trial)
along with Multiplicative Interaction effects. The additive effects are the
classical ANOVA main effects for genotype and environment, the
multiplicative effects follow from a principal component analysis on the
interaction residuals (= genotype by environment means after adjustment for
additive genotype and environment effects). This results in an interaction
characterized by Interaction Principal Components (IPCA) enabling
simultaneous plotting of genotypes and trials.<br><br>
The parameter <code>nPC</code> is used to indicate the number of principal
components that is used in the principal component analysis (PCA). By setting
this parameter to <code>NULL</code> the algorithm determines the best number of
principal components (see Details).<br><br>
By specifying the parameter <code>byYear = TRUE</code>, a separate analysis will be
done for every year in the data. Combining the option with <code>nPC = NULL</code>
may result in different numbers of principal components per year. The AMMI
estimates will still be returned as a single data.frame, but the other
results will be either lists or arrays.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">gxeAmmi</span><span class="op">(</span></span>
<span>  <span class="va">TD</span>,</span>
<span>  trials <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">TD</span><span class="op">)</span>,</span>
<span>  <span class="va">trait</span>,</span>
<span>  nPC <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  byYear <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  center <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  excludeGeno <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  useWt <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-td">TD<a class="anchor" aria-label="anchor" href="#arg-td"></a></dt>
<dd><p>An object of class <code>TD</code>.</p></dd>


<dt id="arg-trials">trials<a class="anchor" aria-label="anchor" href="#arg-trials"></a></dt>
<dd><p>A character string specifying the trials to be analyzed. If
not supplied, all trials are used in the analysis.</p></dd>


<dt id="arg-trait">trait<a class="anchor" aria-label="anchor" href="#arg-trait"></a></dt>
<dd><p>A character string specifying the trait to be analyzed.</p></dd>


<dt id="arg-npc">nPC<a class="anchor" aria-label="anchor" href="#arg-npc"></a></dt>
<dd><p>An integer specifying the number of principal components used
as multiplicative term of genotype-by-trial interaction. If <code>NULL</code>, the
number of principal components is determined by the algorithm using
forward selection. See details.</p></dd>


<dt id="arg-byyear">byYear<a class="anchor" aria-label="anchor" href="#arg-byyear"></a></dt>
<dd><p>Should the analysis be done by year? If <code>TRUE</code> the data
is split by the variable year, analysis is performed and the results are
merged together and returned.</p></dd>


<dt id="arg-center">center<a class="anchor" aria-label="anchor" href="#arg-center"></a></dt>
<dd><p>Should the variables be shifted to be zero centered?</p></dd>


<dt id="arg-excludegeno">excludeGeno<a class="anchor" aria-label="anchor" href="#arg-excludegeno"></a></dt>
<dd><p>An optional character vector with names of genotypes to
be excluded from the analysis. If <code>NULL</code>, all genotypes are used.</p></dd>


<dt id="arg-usewt">useWt<a class="anchor" aria-label="anchor" href="#arg-usewt"></a></dt>
<dd><p>Should weighting be used when modeling? Requires a column
<code>wt</code> in <code>TD</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An object of class <code><a href="AMMI.html">AMMI</a></code>, a list containing:</p>
<dl><dt>envScores</dt>
<dd><p>A matrix with environmental scores.</p></dd>

<dt>genoScores</dt>
<dd><p>A matrix with genotypic scores.</p></dd>

<dt>importance</dt>
<dd><p>A data.frame containing the importance of the principal
components.</p></dd>

<dt>anova</dt>
<dd><p>A data.frame containing anova scores of the AMMI analysis.</p></dd>

<dt>fitted</dt>
<dd><p>A data.frame containing fitted values from the AMMI model.</p></dd>

<dt>trait</dt>
<dd><p>A character string containing the analyzed trait.</p></dd>

<dt>envMean</dt>
<dd><p>A numerical vector containing the environmental means.</p></dd>

<dt>genoMean</dt>
<dd><p>A numerical vector containing the genotypic means.</p></dd>

<dt>overallMean</dt>
<dd><p>A numerical value containing the overall mean.</p></dd>

</dl><p>If <code>byYear</code> = <code>TRUE</code>, all returned items in the AMMI object except
<code>fitted</code> will consist of a list of results by year.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>First a linear model \(trait = genotype + trial + \epsilon\) is fitted with
both genotype and trial fixed components in the model.<br>
The residuals from the fitted model are then used in a PCA. If <code>nPC</code> is
not <code>NULL</code> a single PCA is done using <code><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></code> with
maximum rank <code>nPC</code>.<br>
In case <code>nPC = NULL</code>, the PCA is first done with one PC. Then using
forward selection one by one the number of PCs is increased as long as the
added component is significant in the analysis.<br>
AMMI estimates are then computed using the results of the PCA.<br></p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Gauch H.G. (1992) Statistical Analysis of Regional Yield Trials:
AMMI Analysis of Factorial Designs. Elsevier, Amsterdam.</p>
<p>Yan, W., Kang, M. (2002). GGE Biplot Analysis. Boca Raton: CRC
Press.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other AMMI:
<code><a href="fitted.AMMI.html">fitted.AMMI</a>()</code>,
<code><a href="plot.AMMI.html">plot.AMMI</a>()</code>,
<code><a href="report.AMMI.html">report.AMMI</a>()</code>,
<code><a href="residuals.AMMI.html">residuals.AMMI</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## Run AMMI analysis on TDMaize.</span></span></span>
<span class="r-in"><span><span class="va">geAmmi</span> <span class="op">&lt;-</span> <span class="fu">gxeAmmi</span><span class="op">(</span>TD <span class="op">=</span> <span class="va">TDMaize</span>, trait <span class="op">=</span> <span class="st">"yld"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Summarize results.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">geAmmi</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Principal components </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ====================</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                              PC1       PC2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Standard deviation     161.12397 136.06980</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Proportion of Variance   0.29796   0.21250</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Cumulative Proportion    0.29796   0.51046</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Anova </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> =====</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Analysis of Variance Table</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Response: yld</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                Df    Sum Sq  Mean Sq   F value    Pr(&gt;F)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Trial           7 127771687 18253098 1466.4731 &lt; 2.2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Genotype      210  13821018    65814    5.2876 &lt; 2.2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Interactions 1470  18296997    12447                        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PC1           216   5451796    25240    2.9306 &lt; 2.2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PC2           214   3888148    18169    2.1096  1.31e-14 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residuals    1040   8957053     8613                        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Environment scores </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ==================</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               PC1        PC2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> HN96b -0.19530892  0.7066260</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> IS92a  0.15345251 -0.3083436</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> IS94a  0.01300981 -0.3578091</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> LN96a -0.25229650  0.1268734</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> LN96b -0.35806958  0.1276750</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NS92a  0.85058379  0.2513096</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> SS92a -0.09087845 -0.4011956</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> SS94a -0.12049264 -0.1451358</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Create a biplot of genotypes and environment interaction with PC1 and PC2.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">geAmmi</span>, plotType <span class="op">=</span> <span class="st">"AMMI2"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="gxeAmmi-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Create a pdf report summarizing the results.</span></span></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/statgenSTA/man/report.html" class="external-link">report</a></span><span class="op">(</span><span class="va">geAmmi</span>, outfile <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".pdf"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in report.AMMI(geAmmi, outfile = tempfile(fileext = ".pdf")):</span> An installation of LaTeX is required to create a pdf report.</span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bart-Jan van Rossum.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

